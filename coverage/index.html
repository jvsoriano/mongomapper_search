<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Mongomapper search</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.5.3/jquery-1.6.2.min.js' type='text/javascript'></script>
    <script src='./assets/0.5.3/jquery.dataTables.min.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/fancybox/jquery.fancybox-1.3.1.pack.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/jquery.timeago.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/jquery.url.js' type='text/javascript'></script>   
    <script src='./assets/0.5.3/highlight.pack.js' type='text/javascript'></script>  
    <script src='./assets/0.5.3/app.js' type='text/javascript'></script>    
    <link href='./assets/0.5.3/stylesheet.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/highlight.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/fancybox/jquery.fancybox-1.3.1.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link href='./assets/0.5.3/smoothness/jquery-ui-1.8.4.custom.css' media='screen, projection, print' rel='stylesheet' type='text/css'>    
    <link rel="shortcut icon" type="image/png" href="./assets/0.5.3/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.5.3/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.5.3/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2011-09-21T17:53:15-03:00">2011-09-21T17:53:15-03:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">98.96%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         19.54
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>11</b> files in total.
    <b>193</b> relevant lines. 
    <span class="green"><b>191</b> lines covered</span> and
    <span class="red"><b>2</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#0c6c8d416af9428dba4a5c5562f7338070436dcf" class="src_link" title="lib/mongomapper_search.rb">lib/mongomapper_search.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4927a8273a3d643214fabce3b2bb88fff0578beb" class="src_link" title="lib/mongomapper_search/query.rb">lib/mongomapper_search/query.rb</a></td>
        <td class="yellow strong">83.33 %</td>
        <td>12</td>
        <td>6</td>
        <td>5</td>
        <td>1</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#750bd9b80218beaa638db3b91a4d95b542224be0" class="src_link" title="lib/mongomapper_search/ranked_document.rb">lib/mongomapper_search/ranked_document.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>6.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1c864c9e0a593221fec31a3f680592f08acfcc2d" class="src_link" title="lib/mongomapper_search/search.rb">lib/mongomapper_search/search.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>191</td>
        <td>108</td>
        <td>108</td>
        <td>0</td>
        <td>39.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#45c3a154e6ee1449dc48ae6f0c3e4cc660358278" class="src_link" title="lib/mongomapper_search/util.rb">lib/mongomapper_search/util.rb</a></td>
        <td class="green strong">95.83 %</td>
        <td>47</td>
        <td>24</td>
        <td>23</td>
        <td>1</td>
        <td>160.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ea2ca48a762a4b74f17308285b378f42869b1e3a" class="src_link" title="spec/models/category.rb">spec/models/category.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#aae0ddad4c1d68060337006ba4efee7e36bb1c0f" class="src_link" title="spec/models/product.rb">spec/models/product.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>13</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5431d9d7b998aa92efe7f3f78ca20d3f1ba87621" class="src_link" title="spec/models/subproduct.rb">spec/models/subproduct.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#32ecaae34d2897fc358b9252d4c674ce2cff5628" class="src_link" title="spec/models/tag.rb">spec/models/tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>6</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e0932d4e2d4ae63e4801a04669c5dbf9ec7a33a3" class="src_link" title="spec/models/variant.rb">spec/models/variant.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e94e751a2c002fff70579714892cc723939e4b91" class="src_link" title="spec/util_spec.rb">spec/util_spec.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>41</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.5.3 
        and simplecov-html v0.5.3<br/>
        using RSpec
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="0c6c8d416af9428dba4a5c5562f7338070436dcf">
  <div class="header">
    <h3>lib/mongomapper_search.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;mongomapper_search/search&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;mongomapper_search/util&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;mongomapper_search/query&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &quot;mongomapper_search/ranked_document&quot;</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4927a8273a3d643214fabce3b2bb88fff0578beb">
  <div class="header">
    <h3>lib/mongomapper_search/query.rb</h3>
    <h4><span class="yellow">83.33 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Plucky</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Query</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def search(query, options={})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">      #Fix class search</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="5">
          <span class="hits">3</span>
          
          <code class="ruby">      if first</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="6">
          <span class="hits">3</span>
          
          <code class="ruby">        first.class.search(query, options, self.criteria.source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="8">
          
          
          <code class="ruby">        self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="750bd9b80218beaa638db3b91a4d95b542224be0">
  <div class="header">
    <h3>lib/mongomapper_search/ranked_document.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RankedDocument</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :document, :rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(document)</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="5">
          <span class="hits">20</span>
          
          <code class="ruby">    self.document = document</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def ==(other_ranked_doc)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="9">
          <span class="hits">14</span>
          
          <code class="ruby">    self.document == other_ranked_doc.document</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"> end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1c864c9e0a593221fec31a3f680592f08acfcc2d">
  <div class="header">
    <h3>lib/mongomapper_search/search.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>108</b> relevant lines. 
      <span class="green"><b>108</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MongoMapper</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Search</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    included do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      cattr_accessor :search_fields, :allow_empty_search, :stem_keywords, :match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      @classes ||= []</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      @classes &lt;&lt; base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.classes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      @classes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    module ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      def search_in(*args)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">        options = args.last.is_a?(Hash) &amp;&amp; [:allow_empty_search, :stem_keywords].include?(args.last.keys.first) ? args.pop : {}</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">        self.match              = [:any, :all].include?(options[:match]) ? options[:match] : :any</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">        self.allow_empty_search = [true, false].include?(options[:allow_empty_search]) ? options[:allow_empty_search] : false</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">        self.stem_keywords      = [true, false].include?(options[:stem_keywords]) ? options[:allow_empty_search] : false</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">        self.search_fields      = self.search_fields || {}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">        args.each do |arg|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="28">
          <span class="hits">5</span>
          
          <code class="ruby">          if arg.class == Hash</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">            arg.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="30">
          <span class="hits">4</span>
          
          <code class="ruby">              if key.class == Hash</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="31">
          <span class="hits">3</span>
          
          <code class="ruby">                key.each do |sub_key, sub_value|</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="32">
          <span class="hits">3</span>
          
          <code class="ruby">                  field = &quot;_#{sub_key}_#{sub_value}&quot;.to_sym</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">                  key field, Array</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">                  ensure_index field, :background =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">                  self.search_fields[key] = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">                end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">              else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">                field = &quot;_#{key}&quot;.to_sym</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">                key field, Array</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">                ensure_index field, :background =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">                self.search_fields[key] = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">              end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">              field = &quot;_#{arg}&quot;.to_sym</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">              key field, Array</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="47">
          <span class="hits">4</span>
          
          <code class="ruby">              ensure_index field, :background =&gt; true</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="48">
          <span class="hits">4</span>
          
          <code class="ruby">              self.search_fields[arg] = 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">              </code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">        before_save :set_keywords</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      def search_a_field(search_match, field, regexed_keywords, results, boost, terms, total, criteria)</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="56">
          <span class="hits">168</span>
          
          <code class="ruby">        if search_match == :all</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="57">
          <span class="hits">48</span>
          
          <code class="ruby">          field_results = where(criteria).where(field =&gt; { &quot;$all&quot; =&gt; regexed_keywords })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        elsif search_match == :any</code>
        </li>
      
        <li class="covered" data-hits="120" data-linenumber="59">
          <span class="hits">120</span>
          
          <code class="ruby">          field_results = where(criteria).where(field =&gt; regexed_keywords )</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="61">
          <span class="hits">168</span>
          
          <code class="ruby">        field_results.each do |field_result|</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="62">
          <span class="hits">20</span>
          
          <code class="ruby">          result = RankedDocument.new(field_result)</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="63">
          <span class="hits">20</span>
          
          <code class="ruby">          rank = 0</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="64">
          <span class="hits">20</span>
          
          <code class="ruby">          terms.each do |term|</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="65">
          <span class="hits">27</span>
          
          <code class="ruby">            rank += boost * tf_idf(field, term, result.document[field], total)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="68">
          <span class="hits">20</span>
          
          <code class="ruby">          if !results.include?(result)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="69">
          <span class="hits">13</span>
          
          <code class="ruby">            result.rank = rank</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="70">
          <span class="hits">13</span>
          
          <code class="ruby">            results &lt;&lt; result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="72">
          <span class="hits">7</span>
          
          <code class="ruby">            i = results.index result</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="73">
          <span class="hits">7</span>
          
          <code class="ruby">            results[i].rank += rank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">      def tf_idf(field, term, terms, total)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="79">
          <span class="hits">27</span>
          
          <code class="ruby">        tf(term, terms) * idf(field, term, total)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">      def tf(term, terms)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="83">
          <span class="hits">27</span>
          
          <code class="ruby">        terms.count(term)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">      def idf(field, term, total)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="87">
          <span class="hits">27</span>
          
          <code class="ruby">        df = where(field =&gt; /#{term}/ ).count</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="88">
          <span class="hits">27</span>
          
          <code class="ruby">        if df != 0</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="89">
          <span class="hits">20</span>
          
          <code class="ruby">          Math.log(total/df)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="91">
          <span class="hits">7</span>
          
          <code class="ruby">          0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">      def search(query, options={}, criteria = {})</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="96">
          <span class="hits">24</span>
          
          <code class="ruby">        return all(criteria) if query.blank? &amp;&amp; (options[:allow_empty_search] || allow_empty_search)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="98">
          <span class="hits">21</span>
          
          <code class="ruby">        keywords = Util.normalize_keywords(query, stem_keywords)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="100">
          <span class="hits">21</span>
          
          <code class="ruby">        unique_keywords = keywords.uniq</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="102">
          <span class="hits">21</span>
          
          <code class="ruby">        regexed_keywords = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">                        </code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="104">
          <span class="hits">21</span>
          
          <code class="ruby">        unique_keywords.each do |keyword|</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="105">
          <span class="hits">24</span>
          
          <code class="ruby">          regexed_keywords.concat([/#{keyword}/])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">         </code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="108">
          <span class="hits">21</span>
          
          <code class="ruby">        search_match = options[:match]||self.match</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="110">
          <span class="hits">21</span>
          
          <code class="ruby">        total = all.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="112">
          <span class="hits">21</span>
          
          <code class="ruby">        results = []</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="113">
          <span class="hits">21</span>
          
          <code class="ruby">        self.search_fields.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="168" data-linenumber="114">
          <span class="hits">168</span>
          
          <code class="ruby">          if key.class == Hash</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="115">
          <span class="hits">63</span>
          
          <code class="ruby">            key.each do |sub_key, sub_value|</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="116">
          <span class="hits">63</span>
          
          <code class="ruby">              field = &quot;_#{sub_key}_#{sub_value}&quot;.to_sym</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="117">
          <span class="hits">63</span>
          
          <code class="ruby">              search_a_field search_match, field, regexed_keywords, results, value, unique_keywords, total, criteria</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="120">
          <span class="hits">105</span>
          
          <code class="ruby">            field = &quot;_#{key}&quot;.to_sym</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="121">
          <span class="hits">105</span>
          
          <code class="ruby">            search_a_field search_match, field, regexed_keywords, results, value, unique_keywords, total, criteria</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="125">
          <span class="hits">21</span>
          
          <code class="ruby">        results.sort { |a,b| b.rank &lt;=&gt; a.rank }</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="126">
          <span class="hits">21</span>
          
          <code class="ruby">        documents = []</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="127">
          <span class="hits">21</span>
          
          <code class="ruby">        results.each do |result|</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="128">
          <span class="hits">13</span>
          
          <code class="ruby">          documents &lt;&lt; result.document</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="131">
          <span class="hits">21</span>
          
          <code class="ruby">        documents</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      # Goes through all documents in the class that includes Mongoid::Search</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">      # and indexes the keywords.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">      def index_keywords!</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="137">
          <span class="hits">2</span>
          
          <code class="ruby">        all.each { |d| d.index_keywords! }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="139">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">    module InstanceMethods #:nodoc:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">      # Indexes the document keywords</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">      def index_keywords!</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="145">
          <span class="hits">2</span>
          
          <code class="ruby">        self.search_fields.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="146">
          <span class="hits">16</span>
          
          <code class="ruby">          if key.class == Hash</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="147">
          <span class="hits">6</span>
          
          <code class="ruby">            key.each do |sub_key, sub_value|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="148">
          <span class="hits">6</span>
          
          <code class="ruby">              set_search_field key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="151">
          <span class="hits">10</span>
          
          <code class="ruby">            set_search_field key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="154">
          <span class="hits">2</span>
          
          <code class="ruby">        save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="155">
          <span class="hits">2</span>
          
          <code class="ruby">        true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    private</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="160">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_keywords(key)</code>
        </li>
      
        <li class="covered" data-hits="328" data-linenumber="161">
          <span class="hits">328</span>
          
          <code class="ruby">      Util.keywords(self, key, stem_keywords)</code>
        </li>
      
        <li class="covered" data-hits="287" data-linenumber="162">
          <span class="hits">287</span>
          
          <code class="ruby">                .flatten.reject{|k| k.nil? || k.empty?}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_search_field(key)</code>
        </li>
      
        <li class="covered" data-hits="328" data-linenumber="166">
          <span class="hits">328</span>
          
          <code class="ruby">      if key.class == Hash</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="167">
          <span class="hits">123</span>
          
          <code class="ruby">        key.each do |sub_key, sub_value|</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="168">
          <span class="hits">123</span>
          
          <code class="ruby">          keywords = get_keywords(key)</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="169">
          <span class="hits">123</span>
          
          <code class="ruby">          instance_variable_set &quot;@_#{sub_key}_#{sub_value}&quot;.to_sym, keywords</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="172">
          <span class="hits">205</span>
          
          <code class="ruby">        keywords = get_keywords(key)</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="173">
          <span class="hits">205</span>
          
          <code class="ruby">        instance_variable_set &quot;@_#{key}&quot;.to_sym, keywords</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="178">
          <span class="hits">1</span>
          
          <code class="ruby">    def set_keywords</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="179">
          <span class="hits">39</span>
          
          <code class="ruby">      self.search_fields.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="312" data-linenumber="180">
          <span class="hits">312</span>
          
          <code class="ruby">        if key.class == Hash</code>
        </li>
      
        <li class="covered" data-hits="117" data-linenumber="181">
          <span class="hits">117</span>
          
          <code class="ruby">          key.each do |sub_key, sub_value|</code>
        </li>
      
        <li class="covered" data-hits="117" data-linenumber="182">
          <span class="hits">117</span>
          
          <code class="ruby">            set_search_field key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="195" data-linenumber="185">
          <span class="hits">195</span>
          
          <code class="ruby">          set_search_field key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="45c3a154e6ee1449dc48ae6f0c3e4cc660358278">
  <div class="header">
    <h3>lib/mongomapper_search/util.rb</h3>
    <h4><span class="green">95.83 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Util</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.keywords(klass, field, stem_keywords, ignore_list=[])</code>
        </li>
      
        <li class="covered" data-hits="328" data-linenumber="4">
          <span class="hits">328</span>
          
          <code class="ruby">    if field.is_a?(Hash)</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="5">
          <span class="hits">123</span>
          
          <code class="ruby">      field.keys.map do |key|</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="6">
          <span class="hits">123</span>
          
          <code class="ruby">        attribute = klass.send(key)</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="7">
          <span class="hits">123</span>
          
          <code class="ruby">        unless attribute.blank?</code>
        </li>
      
        <li class="covered" data-hits="111" data-linenumber="8">
          <span class="hits">111</span>
          
          <code class="ruby">          method = field[key]</code>
        </li>
      
        <li class="covered" data-hits="111" data-linenumber="9">
          <span class="hits">111</span>
          
          <code class="ruby">          if attribute.is_a?(Array)</code>
        </li>
      
        <li class="covered" data-hits="73" data-linenumber="10">
          <span class="hits">73</span>
          
          <code class="ruby">            if method.is_a?(Array)</code>
        </li>
      
        <li class="missed" data-hits="0" data-linenumber="11">
          
          
          <code class="ruby">              method.map {|m| attribute.map { |a| Util.normalize_keywords a.send(m), stem_keywords, ignore_list } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">            else</code>
        </li>
      
        <li class="covered" data-hits="222" data-linenumber="13">
          <span class="hits">222</span>
          
          <code class="ruby">              attribute.map(&amp;method).map { |t| Util.normalize_keywords t, stem_keywords, ignore_list }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="16">
          <span class="hits">38</span>
          
          <code class="ruby">            Util.normalize_keywords(attribute.send(method), stem_keywords, ignore_list)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="21">
          <span class="hits">205</span>
          
          <code class="ruby">      value = klass[field]</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="22">
          <span class="hits">205</span>
          
          <code class="ruby">      if value</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="23">
          <span class="hits">123</span>
          
          <code class="ruby">        value = value.join(' ') if value.respond_to?(:join)</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="24">
          <span class="hits">123</span>
          
          <code class="ruby">        Util.normalize_keywords(value, stem_keywords, ignore_list) if value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="82" data-linenumber="26">
          <span class="hits">82</span>
          
          <code class="ruby">        []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.normalize_keywords(text, stem_keywords, ignore_list=[])</code>
        </li>
      
        <li class="covered" data-hits="340" data-linenumber="32">
          <span class="hits">340</span>
          
          <code class="ruby">    return [] if text.blank?</code>
        </li>
      
        <li class="covered" data-hits="297" data-linenumber="33">
          <span class="hits">297</span>
          
          <code class="ruby">    text = text.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      .mb_chars</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      .normalize(:kd)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      .to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      .gsub(/[._:;'&quot;`,?|+={}()!@#%^&amp;*&lt;&gt;~\$\-\\\/\[\]]/, ' ') # strip punctuation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      .gsub(/[^[:alnum:]\s]/,'')   # strip accents</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      .downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      .split(' ')</code>
        </li>
      
        <li class="covered" data-hits="326" data-linenumber="41">
          <span class="hits">326</span>
          
          <code class="ruby">      .reject { |word| word.size &lt; 2 }</code>
        </li>
      
        <li class="covered" data-hits="297" data-linenumber="42">
          <span class="hits">297</span>
          
          <code class="ruby">    text = text.reject { |word| ignore_list.include?(word) } unless ignore_list.blank?</code>
        </li>
      
        <li class="covered" data-hits="297" data-linenumber="43">
          <span class="hits">297</span>
          
          <code class="ruby">    text = text.map(&amp;:stem) if stem_keywords</code>
        </li>
      
        <li class="covered" data-hits="297" data-linenumber="44">
          <span class="hits">297</span>
          
          <code class="ruby">    text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ea2ca48a762a4b74f17308285b378f42869b1e3a">
  <div class="header">
    <h3>spec/models/category.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Category</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MongoMapper::Document</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  key :name, String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  many :products</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="aae0ddad4c1d68060337006ba4efee7e36bb1c0f">
  <div class="header">
    <h3>spec/models/product.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Product</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MongoMapper::Document</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  include MongoMapper::Search</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  key :brand, String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  key :name, String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  key :attrs, Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  many :tags</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  many :subproducts</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :category</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  search_in :brand, :attrs, :outlet, :name =&gt; 3 ,  {:tags =&gt; :name} =&gt; 1, {:category =&gt; :name} =&gt; 1, {:subproducts =&gt; :brand} =&gt; 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5431d9d7b998aa92efe7f3f78ca20d3f1ba87621">
  <div class="header">
    <h3>spec/models/subproduct.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Subproduct</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MongoMapper::EmbeddedDocument</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  key :brand, String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  key :name, String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="32ecaae34d2897fc358b9252d4c674ce2cff5628">
  <div class="header">
    <h3>spec/models/tag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Tag</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include MongoMapper::Document</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  key :name, String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :product</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e0932d4e2d4ae63e4801a04669c5dbf9ec7a33a3">
  <div class="header">
    <h3>spec/models/variant.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Variant &lt; Product</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  key :color, String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  search_in :color</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e94e751a2c002fff70579714892cc723939e4b91">
  <div class="header">
    <h3>spec/util_spec.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># encoding: utf-8</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require File.expand_path(File.dirname(__FILE__) + '/spec_helper')</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">describe Util do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should return an empty array if no text is passed&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;&quot;, false, &quot;&quot;).should == []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should return an array of keywords&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;keyword&quot;, false, &quot;&quot;).class.should == Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should return an array of strings&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;keyword&quot;, false, &quot;&quot;).first.class.should == String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should remove accents from the text passed&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;café&quot;, false, &quot;&quot;).should == [&quot;cafe&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should downcase the text passed&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;CaFé&quot;, false, &quot;&quot;).should == [&quot;cafe&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should split whitespaces, hifens, dots, underlines, etc..&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;CaFé-express.com delicious;come visit, and 'win' an \&quot;iPad\&quot;&quot;, false, &quot;&quot;).should == [&quot;cafe&quot;, &quot;express&quot;, &quot;com&quot;, &quot;delicious&quot;, &quot;come&quot;, &quot;visit&quot;, &quot;and&quot;, &quot;win&quot;, &quot;an&quot;, &quot;ipad&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should stem keywords&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;A runner running and eating&quot;, true, &quot;&quot;).should == [&quot;runner&quot;, &quot;run&quot;, &quot;and&quot;, &quot;eat&quot;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  it &quot;should ignore keywords with less than two words&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    Util.normalize_keywords(&quot;A runner running&quot;, false, &quot;&quot;).should_not include &quot;a&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">   it &quot;should not ignore numbers&quot; do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      Util.normalize_keywords(&quot;Ford T 1908&quot;, false, &quot;&quot;).should include &quot;1908&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">   end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
